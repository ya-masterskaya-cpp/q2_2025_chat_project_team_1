# IRC-Chat  
**IRC-подобный мини-чат с комнатами, авторизацией и API на C++**

## Описание проекта  
`IRC-Chat` — чат работает по модели «клиент-сервер» и использует собственный API поверх TCP/IP. Многопоточный сервер принимает соединения от клиентов и обрабатывает сообщения в режиме реального времени. Поддерживается регистрация, авторизация, создание комнат, обмен сообщениями и логгирование.

---

## Функциональность  

### Клиентская часть:
- Графический интерфейс (wxWidgets)
- Выбор сервера из списка (IP:port)
- Подключение к серверу по IP и порту
- Регистрация и вход по имени и паролю (клиент передаёт серверу хэш пароля)
- Хранение пользовательских настроек, включая токен авторизации, в JSON-файле конфигурации
- Восстановление соединения при помощи файла конфигурации
- Просмотр списка доступных комнат
- Создание и выбор комнаты
- Отправка и приём текстовых сообщений
- Автоматическая загрузка истории сообщений при входе в комнату

### Серверная часть:
- Обработка TCP-соединений от клиентов
- Работа в многопоточном режиме
- Сериализация запросов и ответов (Boost.Serialization)
- Обработка заросов клиента: регистрация, вход, создание комнаты, отправка сообщений
- Проверка активных соединений и отключение неактивных клиентов
- Хранение сообщений в PostgreSQL
- Логгирование событий (info, warning, error)

---

## Протокол взаимодействия (TCP)

### Формат сообщений

Каждое сообщение представляет собой сериализованный `unordered_map<string, string>` (через `boost::archive::text_oarchive`).

**КОНЕЦ СООБЩЕНИЯ ОБОЗНАЧАЕТСЯ СИМВОЛОМ `\0`**  
Важно: клиент должен считывать данные из сокета до символа `\0`, а не ожидать длину в заголовке!

**Пример чтения:** `boost::asio::read_until(socket, buffer, '\0')`

### Пример сообщения

До сериализации:
```json
{
  "action": "login",
  "name": "Alice",
  "password": "hashed_pass",
  "roomname": "general"
}
```

После сериализации — строка, заканчивающаяся `\0`.

---

## Описание клиентских запросов API

| Действие         | Параметры                          | Описание                                  |
|------------------|------------------------------------|-------------------------------------------|
| `create_user`    | `name`, `password`                 | Регистрация нового пользователя           |
| `login`          | `name`, `password`, `roomname`     | Вход в систему и подключение к комнате    |
| `create_room`    | `name`                             | Создание новой комнаты                    |
| `room_list`      | (нет параметров)*                  | Получение списка комнат                   |
| `get_users`      | `name` (имя комнаты)               | Получение пользователей в комнате         |
| `send_message`   | `token`, `message`                 | Отправка текстового сообщения             |
| `disconnect`     | `token`                            | Отключение от комнаты                     |

---

## Ответы сервера

### Успешные
```json
{
  "result": "success",
  "action": "send_message"
}
```

### Ошибка
```json
{
  "result": "error",
  "reason": "Invalid password",
  "initiator": "login"
}
```

Все ответы также сериализуются и заканчиваются `\0`.

---

## Архитектура

Общая схема взаимодействия:  
`[Client] <--> [IRC TCP Server] <--> [Другие клиенты]`

### Компоненты

- **IRC TCP Server**  
  Обрабатывает клиентские запросы, управляет подключениями, авторизацией и рассылкой сообщений. Реализован с использованием Boost.Asio и потоков.

- **IRC Chat Database Layer**
  // TODO: дополнить подробным описанием из /doc/README_irc_chat_db.md от Алексея Т
  Реализует слой работы с базой данных для IRC-чата с поддержкой PostgreSQL, пулом соединений, идентификаторами на основе UUID и репозиториями для пользователей, комнат, сообщений и участников комнат.
  Вся бизнес-логика отделена от слоя хранения данных (repository pattern).

- **ChatClient (wxWidgets GUI)**  
  Интерфейсный клиент, реализующий подключение, взаимодействие с сервером, отображение сообщений и списков.

---

## Сборка проекта

**Требования:**
// TODO: скорректировать, если conan не используем
- Linux / Windows
- C++17
- CMake 3.11+
- Conan 1.65+
- wxWidgets (GUI клиента)
- Boost (asio, serialization и т.д.)
- PostgreSQL (если используется хранилище)

**Сборка:**
// TODO: скорректировать команды сборки
```bash
mkdir build_release && cd build_release
conan install .. --build missing -s compiler.libcxx=libstdc++11 -s build_type=Release
cmake .. -DCMAKE_BUILD_TYPE=Release
cmake --build .
```

---

## Тестирование

Тесты собираются и запускаются в режиме отладочной сборки. Поддерживаются фреймворки Catch2 и GoogleTest.
// TODO: дополнить CMakelist условием сборки тестов только при отладочной сборки