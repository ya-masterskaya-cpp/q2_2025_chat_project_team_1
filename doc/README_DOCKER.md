# IRC Chat Project ‚Äî Docker Guide

## üê≥ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å Docker Compose

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–µ–∫—Ç–∞
```sh
git clone <your_repo_url>
cd <your_project_folder>
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–ª—è –ë–î  
–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `.env` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è!):
```env
POSTGRES_USER=chat_user
POSTGRES_PASSWORD=–û—á–µ–Ω—å_—Å–ª–æ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å
POSTGRES_DB=irc_chat

IRC_CHAT_DB_URL=host=postgres dbname=irc_chat user=chat_user password=–û—á–µ–Ω—å_—Å–ª–æ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å
IRC_CHAT_TEST_DB_URL=host=postgres dbname=irc_chat_test user=chat_user password=–û—á–µ–Ω—å_—Å–ª–æ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å
```
> **–í–∞–∂–Ω–æ:** —Ñ–∞–π–ª `.env` –¥–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–µ –ø–æ–ø–∞–¥–∞—Ç—å –≤ git (–¥–æ–±–∞–≤—å—Ç–µ `.env` –≤ `.gitignore`).

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞  
–í –∫–∞—Ç–∞–ª–æ–≥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- `docker-compose.yml`
- `Dockerfile`
- `.env`
- –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ (—Å–µ—Ä–≤–µ—Ä, —Ç–µ—Å—Ç—ã, etc.)
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `wait-for-it.sh` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

### 4. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```sh
docker compose up --build
```
–ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞ –∑–∞–π–º–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, –¥–∞–ª–µ–µ –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –∑–∞ —Å—á–µ—Ç –∫—ç—à–∞.  
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Å–µ—Ä–≤–µ—Ä–∞ –∏ —Ç–µ—Å—Ç–æ–≤ —Å–æ–±–µ—Ä—É—Ç—Å—è –∏ —Å—Ç–∞—Ä—Ç—É—é—Ç.  
–ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `dbtests` –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.

### 5. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
```sh
docker compose logs server
docker compose logs dbtests
docker compose logs postgres
```
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–∏—Ö –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
```sh
docker compose logs -f server
```

### 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä –∏ –ë–î
```sh
docker compose up --build server postgres
```

### 7. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã
```sh
docker compose up --build dbtests
```
–õ–æ–≥–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ —Å–º–æ—Ç—Ä–∏—Ç–µ —á–µ—Ä–µ–∑:
```sh
docker compose logs dbtests
```

### 8. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```sh
docker compose down
```
–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å volume –∏ –ë–î –∑–∞–Ω–æ–≤–æ):
```sh
docker compose down -v
```

### 9. –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä—É—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
```sh
docker compose run --rm server /bin/bash
```
–∏–ª–∏
```sh
docker compose exec postgres psql -U chat_user -d irc_chat
```

### 10. –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–¥? –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ!
```sh
docker compose up --build
```

---

## üß© –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

- –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –∫–æ–º–∞–Ω–¥–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
    ```yaml
    command: ["/bin/sh", "-c", "export PGPASSWORD=$POSTGRES_PASSWORD && sleep 10 && psql -U $POSTGRES_USER -h postgres -d postgres -c 'CREATE DATABASE irc_chat_test;' || true && ./build/DbTests"]
    ```
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å —Ç–µ—Å—Ç–∞–º–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `postgresql-client` (–≤ Dockerfile):
    ```dockerfile
    RUN apt-get update && apt-get install -y postgresql-client
    ```
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –æ–∂–∏–¥–∞–Ω–∏—è (`wait-for-it.sh`), –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –æ–±—Ä–∞–∑ –∏ –≤ –∫–æ–º–∞–Ω–¥—É –∑–∞–ø—É—Å–∫–∞.
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env` –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## üö© –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–Ω–∞:**  
  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ `psql` –∏ —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–∫–∏–Ω—É—Ç—ã.

- **"connection refused":**  
  –ó–Ω–∞—á–∏—Ç, —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ä–∞–Ω—å—à–µ –ë–î. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –∏–ª–∏ `wait-for-it`.

- **Config file not found:**  
  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª —Ä–µ–∞–ª—å–Ω–æ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è (–∏–ª–∏ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è volume) –≤ Dockerfile –∏ –µ–≥–æ –ø—É—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `WORKDIR`.

- **psql: not found:**  
  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç `postgresql-client` –≤ Dockerfile –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è CI/CD

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env.example` –¥–ª—è —à–∞–±–ª–æ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
- –•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ä–∞–±–æ—á–∏–µ –ø–∞—Ä–æ–ª–∏.
- –î–ª—è –¥–µ–ø–ª–æ—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ volume –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ init-—Å–∫—Ä–∏–ø—Ç—ã –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.

---

## üõ† –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
    ```sh
    docker compose run dbtests env | grep IRC_CHAT
    ```

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞:
    ```sh
    docker compose run server ls -l /app/data/config.json
    ```

- –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î –≤—Ä—É—á–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):
    ```sh
    docker compose exec postgres psql -U chat_user -c 'CREATE DATABASE irc_chat_test;'
    ```

> –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!

---

## üìö –°—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Docker Compose](https://docs.docker.com/compose/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è PostgreSQL Docker](https://hub.docker.com/_/postgres)
- [wait-for-it](https://github.com/vishnubob/wait-for-it)

