<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IRC-Chat: IRC Chat Database Layer (C++ / PostgreSQL)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IRC-Chat<span id="projectnumber">&#160;Release</span>
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__r_e_a_d_m_e__irc__chat__db.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">IRC Chat Database Layer (C++ / PostgreSQL)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md84"></a></p>
<h1><a class="anchor" id="autotoc_md85"></a>
üì¶ –û–ø–∏—Å–∞–Ω–∏–µ</h1>
<p>–ú–æ–¥—É–ª—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è IRC-—á–∞—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π PostgreSQL: –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ UUID, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–º–Ω–∞—Ç, —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. <br  />
 –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç —Å–ª–æ—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è <em>Repository Pattern</em>).</p>
<hr  />
<h1><a class="anchor" id="autotoc_md87"></a>
üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∫–ª–∞—Å—Å—ã</h1>
<h2><a class="anchor" id="autotoc_md88"></a>
1. <code>util::Tagged</code>, <code>util::TaggedUUID</code></h2>
<ul>
<li><b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</b> –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ UUID (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code>UserId</code>, <code>RoomId</code>).</li>
<li><b>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:</b> –ò—Å–∫–ª—é—á–∞–µ—Ç —Å–º–µ—à–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ä–∞–∑–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md90"></a>
2. <code>postgres::ConnectionPool</code></h2>
<ul>
<li><b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</b> Thread-safe –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å PostgreSQL –¥–ª—è —Ä–∞–±–æ—Ç—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.</li>
<li><b>–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:</b><ul>
<li><code>GetConnection()</code></li>
<li><code>GetConnection(std::chrono::milliseconds timeout)</code></li>
</ul>
</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md92"></a>
3. <code>UserRecord</code>, <code>RoomRecord</code>, <code>MessageRecord</code>, <code>RoomMemberRecord</code></h2>
<ul>
<li><b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</b> –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ–º–Ω–∞—Ç–∞, —Å–æ–æ–±—â–µ–Ω–∏–µ, —á–ª–µ–Ω—Å—Ç–≤–æ).</li>
<li><b>–ü–æ–ª—è:</b> UUID, –∏–º–µ–Ω–∞, —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏ –¥—Ä.</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md94"></a>
4. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</h2>
<p>–ö–∞–∂–¥—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É —Å—É—â–Ω–æ—Å—Ç—å:</p>
<h3><a class="anchor" id="autotoc_md95"></a>
<code>UsersRepository</code></h3>
<ul>
<li><b>–ú–µ—Ç–æ–¥—ã:</b><ul>
<li><code>Save(const std::string&amp; username, const std::string&amp; password_hash)</code></li>
<li><code>std::vector&lt;UserRecord&gt; LoadAll() const</code></li>
<li><code>std::optional&lt;UserRecord&gt; FindByUsername(const std::string&amp;) const</code></li>
<li><code>std::optional&lt;UserRecord&gt; FindById(const UserId&amp;) const</code></li>
<li><code>void DeleteByUsername(const std::string&amp;) const</code></li>
<li><code>std::vector&lt;UserRecord&gt; LoadPage(int offset, int limit) const;</code></li>
<li><code>std::unordered_map&lt;std::string, std::string&gt; LoadUserMap() const;</code></li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md96"></a>
<code>RoomsRepository</code></h3>
<ul>
<li><b>–ú–µ—Ç–æ–¥—ã:</b><ul>
<li><code>Save(const std::string&amp;)</code></li>
<li><code>std::vector&lt;RoomRecord&gt; LoadAll() const</code></li>
<li><code>std::optional&lt;RoomRecord&gt; FindByName(const std::string&amp;) const</code></li>
<li><code>void DeleteById(const RoomId&amp;) const</code></li>
<li><code>std::vector&lt;RoomRecord&gt; LoadPage(int offset, int limit) const</code></li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md97"></a>
<code>MessagesRepository</code></h3>
<ul>
<li><b>–ú–µ—Ç–æ–¥—ã:</b><ul>
<li><code>Save(const UserId&amp;, const RoomId&amp;, const std::string&amp;)</code></li>
<li><code>std::vector&lt;MessageRecord&gt; LoadRecent(const RoomId&amp;, int max_items) const</code></li>
<li><code>std::vector&lt;MessageRecord&gt; LoadPage(const RoomId&amp;, int offset, int limit) const</code></li>
<li><code>void DeleteById(const MessageId&amp;) const</code></li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md98"></a>
<code>RoomMembersRepository</code></h3>
<ul>
<li><b>–ú–µ—Ç–æ–¥—ã:</b><ul>
<li><code>Save(const UserId&amp;, const RoomId&amp;)</code></li>
<li><code>Remove(const UserId&amp;, const RoomId&amp;)</code></li>
<li><code>LoadMembers(const RoomId&amp;)</code></li>
<li><code>LoadRooms(const UserId&amp;)</code></li>
</ul>
</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md100"></a>
5. <code>postgres::Database</code></h2>
<ul>
<li><b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</b> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –º–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.</li>
<li><b>–ú–µ—Ç–æ–¥:</b> <code>GetTransaction()</code> ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md102"></a>
6. <code>IRCDBWrapper</code> (–≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î)</h2>
<ul>
<li><b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</b> –ö–ª–∞—Å—Å –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏.</li>
<li><b>–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:</b></li>
</ul>
<h3><a class="anchor" id="autotoc_md103"></a>
–†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
<ul>
<li><code>AddUserToDB(name, pass_hash)</code> ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</li>
<li><code>GetAllUsers()</code> ‚Äî –ø–æ–ª—É—á–∏—Ç—å map&lt;–∏–º—è, —Ö–µ—à&gt;.</li>
<li><code>FindUserByName(username)</code> ‚Äî –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏.</li>
<li><code>FindUserById(id)</code> ‚Äî –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ id.</li>
<li><code>DeleteUserByName(username)</code> ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏.</li>
</ul>
<h3><a class="anchor" id="autotoc_md104"></a>
–†–∞–±–æ—Ç–∞ —Å –∫–æ–º–Ω–∞—Ç–∞–º–∏</h3>
<ul>
<li><code>AddRoomToDB(room_name)</code> ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É.</li>
<li><code>FindRoomByName(room_name)</code> ‚Äî –Ω–∞–π—Ç–∏ –∫–æ–º–Ω–∞—Ç—É –ø–æ –∏–º–µ–Ω–∏.</li>
<li><code>DeleteRoomByName(room_name)</code> ‚Äî —É–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É –ø–æ –∏–º–µ–Ω–∏.</li>
<li><code>GetAllRooms()</code> ‚Äî –≤—Å–µ –∫–æ–º–Ω–∞—Ç—ã.</li>
<li><code>GetRoomsPage(offset, limit)</code> ‚Äî –ø–∞–≥–∏–Ω–∞—Ü–∏—è –∫–æ–º–Ω–∞—Ç.</li>
</ul>
<h3><a class="anchor" id="autotoc_md105"></a>
–£—á–∞—Å—Ç–∏–µ –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö</h3>
<ul>
<li><code>AddUserToRoomByName(username, roomname)</code> ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–º–Ω–∞—Ç—É –ø–æ –∏–º–µ–Ω–∞–º.</li>
<li><code>GetRoomMembersByName(roomname)</code> ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–æ–º–Ω–∞—Ç–µ –ø–æ –µ—ë –∏–º–µ–Ω–∏.</li>
<li><code>RemoveUserFromRoomByName(username, roomname)</code> ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–º–Ω–∞—Ç—ã –ø–æ –∏–º–µ–Ω–∞–º.</li>
</ul>
<h3><a class="anchor" id="autotoc_md106"></a>
–†–∞–±–æ—Ç–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏</h3>
<ul>
<li><code>AddMessage(username, roomname, text)</code> ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–º–Ω–∞—Ç—É.</li>
<li><code>GetRecentMessages(roomname, max_items)</code> ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–º–Ω–∞—Ç—ã.</li>
<li><code>GetRoomMessagesPage(roomname, offset, limit)</code> ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.</li>
<li><code>DeleteMessageById(message_id)</code> ‚Äî —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ id.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md108"></a>
üîÑ –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞)</h1>
<p>–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–º–Ω–∞—Ç –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã –º–µ—Ç–æ–¥—ã –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ (–ø–∞–≥–∏–Ω–∞—Ü–∏–∏):</p><ul>
<li><code>UsersRepository::LoadPage(offset, limit)</code></li>
<li><code>RoomsRepository::LoadPage(offset, limit)</code></li>
<li><code>MessagesRepository::LoadPage(room_id, offset, limit)</code></li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md110"></a>
üõ†Ô∏è –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h1>
<div class="fragment"><div class="line"><a class="code hl_class" href="class_i_r_c_d_b_wrapper.html">IRCDBWrapper</a> db(<span class="stringliteral">&quot;host=localhost dbname=test_db user=test_user password=test_password&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span></div>
<div class="line">db.AddUserToDB(<span class="stringliteral">&quot;alice&quot;</span>, <span class="stringliteral">&quot;hash&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> user = db.FindUserByName(<span class="stringliteral">&quot;alice&quot;</span>);</div>
<div class="line">db.DeleteUserByName(<span class="stringliteral">&quot;alice&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// –ö–æ–º–Ω–∞—Ç—ã</span></div>
<div class="line">db.AddRoomToDB(<span class="stringliteral">&quot;main&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> room = db.FindRoomByName(<span class="stringliteral">&quot;main&quot;</span>);</div>
<div class="line">db.DeleteRoomByName(<span class="stringliteral">&quot;main&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> all_rooms = db.GetAllRooms();</div>
<div class="line"><span class="keyword">auto</span> page = db.GetRoomsPage(0, 2);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// –£—á–∞—Å—Ç–∏–µ –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö</span></div>
<div class="line">db.AddUserToRoomByName(<span class="stringliteral">&quot;alice&quot;</span>, <span class="stringliteral">&quot;main&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> members = db.GetRoomMembersByName(<span class="stringliteral">&quot;general&quot;</span>);</div>
<div class="line">db.RemoveUserFromRoomByName(<span class="stringliteral">&quot;alice&quot;</span>, <span class="stringliteral">&quot;main&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// –°–æ–æ–±—â–µ–Ω–∏—è</span></div>
<div class="line">db.AddMessage(<span class="stringliteral">&quot;alice&quot;</span>, <span class="stringliteral">&quot;main&quot;</span>, <span class="stringliteral">&quot;Hello, chat!&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> msgs = db.GetRecentMessages(<span class="stringliteral">&quot;main&quot;</span>, 5);</div>
<div class="line"><span class="keywordflow">if</span> (!msgs.empty()) db.DeleteMessageById(msgs[0].<span class="keywordtype">id</span>);</div>
<div class="ttc" id="aclass_i_r_c_d_b_wrapper_html"><div class="ttname"><a href="class_i_r_c_d_b_wrapper.html">IRCDBWrapper</a></div><div class="ttdoc">–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö IRC, –≤–∫–ª—é—á–∞—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏,...</div><div class="ttdef"><b>Definition</b> db_wrapper.h:21</div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md112"></a>
üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü</h1>
<div class="fragment"><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keywordflow">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> users (</div>
<div class="line">    id UUID <span class="keyword">PRIMARY</span> KEY,</div>
<div class="line">    username <span class="keywordtype">VARCHAR</span>(<span class="stringliteral">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    password_hash <span class="keywordtype">VARCHAR</span>(<span class="stringliteral">256</span>) <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    registered_at <span class="keywordtype">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">DEFAULT</span> NOW()</div>
<div class="line">);</div>
<div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keywordflow">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> rooms (</div>
<div class="line">    id UUID <span class="keyword">PRIMARY</span> KEY,</div>
<div class="line">    name <span class="keywordtype">VARCHAR</span>(<span class="stringliteral">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    created_at <span class="keywordtype">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">DEFAULT</span> NOW()</div>
<div class="line">);</div>
<div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keywordflow">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> messages (</div>
<div class="line">    id UUID <span class="keyword">PRIMARY</span> KEY,</div>
<div class="line">    user_id UUID <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</div>
<div class="line">    room_id UUID <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">REFERENCES</span> rooms(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</div>
<div class="line">    message TEXT <span class="keyword">NOT</span> <span class="stringliteral">NULL</span>,</div>
<div class="line">    sent_at <span class="keywordtype">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">DEFAULT</span> NOW()</div>
<div class="line">);</div>
<div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keywordflow">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> room_members (</div>
<div class="line">    id UUID <span class="keyword">PRIMARY</span> KEY,</div>
<div class="line">    room_id UUID <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">REFERENCES</span> rooms(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</div>
<div class="line">    user_id UUID <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</div>
<div class="line">    joined_at <span class="keywordtype">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="stringliteral">NULL</span> <span class="keyword">DEFAULT</span> NOW(),</div>
<div class="line">    <span class="keyword">UNIQUE</span>(room_id, user_id)</div>
<div class="line">);</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md114"></a>
üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
<ul>
<li>–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ–±—ë—Ä—Ç–∫–∏ <code><a class="el" href="class_i_r_c_d_b_wrapper.html" title="–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö IRC, –≤–∫–ª—é—á–∞—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏,...">IRCDBWrapper</a></code> (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ–º–Ω–∞—Ç—ã, —É—á–∞—Å—Ç–∏–µ, —Å–æ–æ–±—â–µ–Ω–∏—è) –ø–æ–∫—Ä—ã—Ç—ã –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞–º–∏ –≤ <code>test_postgres.cpp</code>.</li>
<li>–¢–µ—Å—Ç—ã —É—á–∏—Ç—ã–≤–∞—é—Ç –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫: –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –º–µ–∂–¥—É –≤—Å—Ç–∞–≤–∫–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—É–∑–∞ (<code>std::this_thread::sleep_for</code>).</li>
<li>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ (Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ª–µ–≥–∫–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏).</li>
<li>–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤ –±–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ‚Äú—á–∏—Å—Ç–æ–π‚Äù –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md116"></a>
üìö –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã</h1>
<ul>
<li><b>Repository Pattern:</b> –∫–∞–∂–¥—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–µ–π —Å—É—â–Ω–æ—Å—Ç–∏, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤–Ω–µ.</li>
<li><b>Thread-safe Connection Pool:</b> –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –∏–∑ –∫–æ—Ä–æ–±–∫–∏.</li>
<li><b>UUID everywhere:</b> –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ UUID.</li>
<li><b>–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π:</b> –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md118"></a>
‚ö° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h1>
<ul>
<li>–î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ bcrypt/argon2 –¥–ª—è –ø–∞—Ä–æ–ª–µ–π.</li>
<li>–õ–æ–≥–∏–∫—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—ã–Ω–æ—Å–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å (auth service).</li>
<li>–ö–æ–¥ –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∏ thread-safe.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md120"></a>
üìé –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</h1>
<ul>
<li><code>server/tests/test_postgres.cpp</code> ‚Äî unit-—Ç–µ—Å—Ç—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ –±–∞–∑—ã</li>
<li><code><a class="el" href="tagged_8h.html" title="–ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –∏ —à–∞–±–ª–æ–Ω—ã –∫–ª–∞—Å—Å–æ–≤.">tagged.h</a></code> ‚Äî —à–∞–±–ª–æ–Ω —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤</li>
<li><code><a class="el" href="tagged__uuid_8h.html" title="–ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å UUID.">tagged_uuid.h</a></code> ‚Äî UUID –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π</li>
<li><code><a class="el" href="postgres_8h.html" title="–ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL.">postgres.h</a>/.cpp</code> ‚Äî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, Database</li>
<li><code><a class="el" href="db__wrapper_8h.html" title="–ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∫–ª–∞—Å—Å–∞ IRCDBWrapper, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω...">db_wrapper.h</a>/.cpp</code> ‚Äî –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (<a class="el" href="md__r_e_a_d_m_e__db__wrapper.html">—Å–º. –æ—Ç–¥–µ–ª—å–Ω—ã–π README</a>)</li>
</ul>
<hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
